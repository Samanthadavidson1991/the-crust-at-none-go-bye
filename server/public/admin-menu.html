<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin – Menu Editor | None Go Bye</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&family=Pacifico&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="admin-page">
  <script>
    // Login/session check
    fetch('/api/admin/check', { credentials: 'include' })
      .then(r => {
        if (!r.ok) window.location.href = 'login.html';
      });
  </script>
  <script src="/admin-order-toast.js"></script>
  <a href="#main-content" class="skip-link" tabindex="0">Skip to main content</a>
  <header>
    <h1 class="main-heading underline">Admin Menu Editor <button id="lock-page-btn" class="lock-page-btn" onclick="lockAdminPage()">Lock this page</button></h1>
    <nav class="admin-nav" role="navigation" aria-label="Admin navigation">
      <a href="admin-menu.html">Menu Editor</a>
      <a href="stock-management.html">Stock Management</a>
      <a href="timeslots.html">Time Slots</a>
      <a href="orders.html">Orders</a>
      <a href="running-orders.html">Running Orders</a>
      <a href="takings.html">Takings</a>
      <a href="pos.html">POS Manual Order</a>
      <a href="offers.html">Special Offers</a>
    </nav>
  </header>
  <main id="main-content">
    <section class="admin-section">
      <div class="master-toppings">
        <h2>Master Toppings</h2>
        <div class="toppings-group">
          <div class="toppings-category">
            <h3>Pizza Toppings</h3>
            <ul id="pizzaMasterToppingsList" class="toppings-list"></ul>
            <div class="default-prices">
              <label>Vegetable Price (£): <input type="number" id="pizzaVegDefaultPrice" step="0.01" min="0" value="0.60"></label>
              <label>Meat Price (£): <input type="number" id="pizzaMeatDefaultPrice" step="0.01" min="0" value="1.00"></label>
              <label>Other Price (£): <input type="number" id="pizzaOtherDefaultPrice" step="0.01" min="0" value="0.50"></label>
            </div>
            <form id="addPizzaMasterToppingForm" class="topping-form">
              <input type="text" id="pizzaMasterToppingInput" placeholder="Topping name" required>
              <select id="pizzaMasterToppingType" required title="Select topping type">
                <option value="">Type</option>
                <option value="meat">Meat</option>
                <option value="vegetable">Vegetable</option>
                <option value="other">Other</option>
              </select>
              <input type="number" id="pizzaMasterToppingPrice" placeholder="Price (£)" step="0.01" min="0" required>
              <button type="submit">Add Topping</button>
            </form>
          </div>
          <div class="toppings-category">
            <h3>Salad Toppings</h3>
            <ul id="saladMasterToppingsList" class="toppings-list"></ul>
            <div class="default-prices">
              <label>Vegetable Price (£): <input type="number" id="saladVegDefaultPrice" step="0.01" min="0" value="0.60"></label>
              <label>Meat Price (£): <input type="number" id="saladMeatDefaultPrice" step="0.01" min="0" value="1.00"></label>
              <label>Other Price (£): <input type="number" id="saladOtherDefaultPrice" step="0.01" min="0" value="0.50"></label>
            </div>
            <form id="addSaladMasterToppingForm" class="topping-form">
              <input type="text" id="saladMasterToppingInput" placeholder="Topping name" required>
              <select id="saladMasterToppingType" required title="Select topping type">
                <option value="">Type</option>
                <option value="meat">Meat</option>
                <option value="vegetable">Vegetable</option>
                <option value="other">Other</option>
              </select>
              <input type="number" id="saladMasterToppingPrice" placeholder="Price (£)" step="0.01" min="0" required>
              <button type="submit">Add Topping</button>
            </form>
          </div>
          <div class="toppings-category">
            <h3>Other Toppings</h3>
            <ul id="otherMasterToppingsList" class="toppings-list"></ul>
            <div class="default-prices">
              <label>Vegetable Price (£): <input type="number" id="otherVegDefaultPrice" step="0.01" min="0" value="0.60"></label>
              <label>Meat Price (£): <input type="number" id="otherMeatDefaultPrice" step="0.01" min="0" value="1.00"></label>
              <label>Other Price (£): <input type="number" id="otherOtherDefaultPrice" step="0.01" min="0" value="0.50"></label>
            </div>
            <form id="addOtherMasterToppingForm" class="topping-form">
              <input type="text" id="otherMasterToppingInput" placeholder="Topping name" required>
              <select id="otherMasterToppingType" required title="Select topping type">
                <option value="">Type</option>
                <option value="meat">Meat</option>
                <option value="vegetable">Vegetable</option>
                <option value="other">Other</option>
              </select>
              <input type="number" id="otherMasterToppingPrice" placeholder="Price (£)" step="0.01" min="0" required>
              <button type="submit">Add Topping</button>
            </form>
          </div>
        </div>
      </div>
    </section>
  </main>
  <script>
    // --- Lock Page Logic ---
    function lockAdminPage() {
      fetch('/api/admin/lock', { method: 'POST', credentials: 'include' })
        .then(r => {
          if (r.ok) {
            alert('Page locked. You will not be logged out automatically.');
          } else {
            alert('Failed to lock page.');
          }
        });
    }

    // Auto-fill price based on type selection for Pizza Toppings
    document.addEventListener('DOMContentLoaded', function() {
      // Pizza
      const pizzaTypeSelect = document.getElementById('pizzaMasterToppingType');
      const pizzaPriceInput = document.getElementById('pizzaMasterToppingPrice');
      const pizzaVegPrice = document.getElementById('pizzaVegDefaultPrice');
      const pizzaMeatPrice = document.getElementById('pizzaMeatDefaultPrice');
      const pizzaOtherPrice = document.getElementById('pizzaOtherDefaultPrice');
      if (pizzaTypeSelect && pizzaPriceInput) {
        pizzaTypeSelect.addEventListener('change', function() {
          if (this.value === 'vegetable') pizzaPriceInput.value = pizzaVegPrice.value;
          else if (this.value === 'meat') pizzaPriceInput.value = pizzaMeatPrice.value;
          else if (this.value === 'other') pizzaPriceInput.value = pizzaOtherPrice.value;
        });
      }
      // Salad
      const saladTypeSelect = document.getElementById('saladMasterToppingType');
      const saladPriceInput = document.getElementById('saladMasterToppingPrice');
      const saladVegPrice = document.getElementById('saladVegDefaultPrice');
      const saladMeatPrice = document.getElementById('saladMeatDefaultPrice');
      const saladOtherPrice = document.getElementById('saladOtherDefaultPrice');
      if (saladTypeSelect && saladPriceInput) {
        saladTypeSelect.addEventListener('change', function() {
          if (this.value === 'vegetable') saladPriceInput.value = saladVegPrice.value;
          else if (this.value === 'meat') saladPriceInput.value = saladMeatPrice.value;
          else if (this.value === 'other') saladPriceInput.value = saladOtherPrice.value;
        });
      }
      // Other
      const otherTypeSelect = document.getElementById('otherMasterToppingType');
      const otherPriceInput = document.getElementById('otherMasterToppingPrice');
      const otherVegPrice = document.getElementById('otherVegDefaultPrice');
      const otherMeatPrice = document.getElementById('otherMeatDefaultPrice');
      const otherOtherPrice = document.getElementById('otherOtherDefaultPrice');
      if (otherTypeSelect && otherPriceInput) {
        otherTypeSelect.addEventListener('change', function() {
          if (this.value === 'vegetable') otherPriceInput.value = otherVegPrice.value;
          else if (this.value === 'meat') otherPriceInput.value = otherMeatPrice.value;
          else if (this.value === 'other') otherPriceInput.value = otherOtherPrice.value;
        });
      }
    });
  </script>
</body>
</html>